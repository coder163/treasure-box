<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="generator" content="VNote">

    <title>简单工厂设计模式</title>
    <link rel="icon" href="https://github.com/tamlok/vnote/raw/master/src/resources/icons/vnote.ico">

    <style type="text/css">
    /* STYLE_GLOBAL_PLACE_HOLDER */
    </style>

    <style type="text/css">
    /* STYLE_OUTLINE_PLACE_HOLDER */
    /* STYLE_PLACE_HOLDER */
    </style>

    <!-- EXTRA_PLACE_HOLDER -->

<!-- HEAD_PLACE_HOLDER -->
</head>
<body>
<div class="container-fluid">
<div class="row flex-xl-nowrap">
    <div id="outline-panel" style="display:none;" class="d-none d-md-block d-xl-block col-md-3 col-xl-2 bd-toc">
        <div id="outline-content" class="section-nav"></div>
    </div>
    <div id="post-content" class="col-12 col-md-9 col-xl-10 py-md-3 pl-md-5 bd-content">
    <p>​工厂模式（Factory Pattern）是最常用的设计模式之一。这种类型的设计模式属于创建型模式，它提供了一种创建对象的最佳方式。</p>
<p>在工厂模式中，我们在创建对象时不会对客户端暴露创建逻辑，并且是通过使用一个共同的接口来指向新创建的对象。</p>
<h1 id="toc_0">优点<a class="vnote-anchor" href="#toc_0" data-anchor-icon="#"></a></h1>
<ol>
<li>
<p>一个调用者想创建一个对象，只要知道其名称就可以了</p>
</li>
<li>
<p>扩展性高，如果想增加一个产品，只要扩展一个工厂类就可以</p>
</li>
<li>
<p>屏蔽产品的具体实现，调用者只关心产品的接口</p>
</li>
</ol>
<h1 id="toc_1">缺点<a class="vnote-anchor" href="#toc_1" data-anchor-icon="#"></a></h1>
<p>每次增加一个产品时，都需要增加一个具体类和对象实现工厂，使得系统中类的个数成倍增加，在一定程度上增加了系统的复杂度，同时也增加了系统具体类的依赖。</p>
<h1 id="toc_2">应用场景<a class="vnote-anchor" href="#toc_2" data-anchor-icon="#"></a></h1>
<ol>
<li>
<p>日志记录器：记录可能记录到本地硬盘、系统事件、远程服务器等，用户可以选择记录日志到什么地方</p>
</li>
<li>
<p>设计一个连接服务器的框架，需要三个协议，"POP3"、"IMAP"、"HTTP"，可以把这三个作为产品类，共同实现一个接口。</p>
</li>
</ol>
<h1 id="toc_3">实现<a class="vnote-anchor" href="#toc_3" data-anchor-icon="#"></a></h1>
<h1></h1>
<p><img src="_v_images/20210606135125906_2177" alt="" class="view-image"></p>
<h1 id="toc_4">核心单元<a class="vnote-anchor" href="#toc_4" data-anchor-icon="#"></a></h1>
<pre><code class="lang-pascal hljs"><span class="hljs-keyword">unit</span> UnitLogger;
​
<span class="hljs-keyword">interface</span>
​
<span class="hljs-keyword">uses</span>
    System.SysUtils;
​
<span class="hljs-keyword">type</span>
    <span class="hljs-comment">{日志接口}</span>
    ILogger = <span class="hljs-keyword">interface</span>(IUnKnown)
        [<span class="hljs-string">'{2C7DD96A-795F-4D8A-99C7-EC7D4CD9F475}'</span>]
        <span class="hljs-function"><span class="hljs-keyword">procedure</span> <span class="hljs-title">Log</span><span class="hljs-params">()</span>;</span>
    <span class="hljs-keyword">end</span>;
​
    <span class="hljs-comment">{硬盘的实现方式}</span>
    <span class="hljs-title">TDiskLogger</span> = <span class="hljs-keyword">class</span>(TInterfacedObject, ILogger)
    <span class="hljs-keyword">public</span>
        <span class="hljs-function"><span class="hljs-keyword">procedure</span> <span class="hljs-title">Log</span><span class="hljs-params">()</span>;</span> <span class="hljs-keyword">overload</span>;
    <span class="hljs-keyword">end</span>;
​
    <span class="hljs-comment">{控件的实现方式}</span>
    <span class="hljs-title">TComponentLogger</span> = <span class="hljs-keyword">class</span>(TInterfacedObject, ILogger)
        <span class="hljs-function"><span class="hljs-keyword">procedure</span> <span class="hljs-title">Log</span><span class="hljs-params">()</span>;</span> <span class="hljs-keyword">overload</span>;
    <span class="hljs-keyword">end</span>;
​
    <span class="hljs-comment">{定义工厂类}</span>
    <span class="hljs-title">TLoggerFactory</span> = <span class="hljs-keyword">class</span>(TObject)
    <span class="hljs-keyword">public</span>
        <span class="hljs-keyword">class</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">GetLogger</span><span class="hljs-params">(LoggerType: Integer)</span>:</span> ILogger;
    <span class="hljs-keyword">end</span>;
​
<span class="hljs-keyword">implementation</span>
​
<span class="hljs-comment">{ TDiskLogger }</span>
​
<span class="hljs-function"><span class="hljs-keyword">procedure</span> <span class="hljs-title">TDiskLogger</span>.<span class="hljs-title">Log</span>;</span>
<span class="hljs-keyword">begin</span>
    Writeln(<span class="hljs-string">'将日志写入硬盘'</span>);
<span class="hljs-keyword">end</span>;
​
<span class="hljs-comment">{ TComponentLogger }</span>
​
<span class="hljs-function"><span class="hljs-keyword">procedure</span> <span class="hljs-title">TComponentLogger</span>.<span class="hljs-title">Log</span>;</span>
<span class="hljs-keyword">begin</span>
    Writeln(<span class="hljs-string">'将日志在控件上进行展示'</span>);
<span class="hljs-keyword">end</span>;
​
​
<span class="hljs-comment">{ TLoggerFactory }</span>
<span class="hljs-keyword">class</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">TLoggerFactory</span>.<span class="hljs-title">GetLogger</span><span class="hljs-params">(LoggerType: Integer)</span>:</span> ILogger;
<span class="hljs-keyword">begin</span>
    <span class="hljs-keyword">case</span> LoggerType <span class="hljs-keyword">of</span>
        <span class="hljs-number">1</span>:
            <span class="hljs-keyword">begin</span>
                Result := TDiskLogger.Create();
            <span class="hljs-keyword">end</span>;
        <span class="hljs-number">2</span>:
            <span class="hljs-keyword">begin</span>
                Result := TDiskLogger.Create();
            <span class="hljs-keyword">end</span>;
​
    <span class="hljs-keyword">else</span>
        <span class="hljs-keyword">raise</span> Exception.Create(<span class="hljs-string">'类型非法'</span>);
    <span class="hljs-keyword">end</span>;
<span class="hljs-keyword">end</span>;
​
<span class="hljs-keyword">end</span>.
</code></pre>
<h1 id="toc_5">调用<a class="vnote-anchor" href="#toc_5" data-anchor-icon="#"></a></h1>
<pre><code class="lang-pascal hljs"><span class="hljs-keyword">program</span> Project1;
​
<span class="hljs-meta">{$APPTYPE CONSOLE}</span>
​
<span class="hljs-meta">{$R *.res}</span>
​
<span class="hljs-keyword">uses</span>
    System.SysUtils,
    UnitLogger <span class="hljs-keyword">in</span> <span class="hljs-string">'UnitLogger.pas'</span>;
​
<span class="hljs-keyword">begin</span>
    <span class="hljs-keyword">try</span>
        <span class="hljs-keyword">var</span> Logger := TLoggerFactory.GetLogger(<span class="hljs-number">1</span>);
        Logger.log();
​
    <span class="hljs-keyword">except</span>
        <span class="hljs-keyword">on</span> E: Exception <span class="hljs-keyword">do</span>
            Writeln(E.ClassName, <span class="hljs-string">': '</span>, E.<span class="hljs-keyword">Message</span>);
    <span class="hljs-keyword">end</span>;
​
    readln;
<span class="hljs-keyword">end</span>.
</code></pre>
<blockquote>
<p>以上就是工厂模式的简单使用，其实工厂类中的方法最好利用RTTI机制实现对象创建，这样具体的对象就可以实现定制化</p>
</blockquote>

    </div>
</div>
</div>

<div id="container-floating" style="display:none;" class="d-none d-md-block d-xl-block">
    <div id="floating-button" onclick="toggleMore()">
        <p id="floating-more" class="more">&gt;</p>
    </div>
</div>

<!--
<div class="footer" id="vnote-footer">
    <p>Generated by <em><a href="https://tamlok.github.io/vnote/">VNote</a></em>.</p>
</div>
-->
</body>
</html>
