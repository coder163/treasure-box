<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="generator" content="VNote">

    <title>策略设计模式</title>
    <link rel="icon" href="https://github.com/tamlok/vnote/raw/master/src/resources/icons/vnote.ico">

    <style type="text/css">
    /* STYLE_GLOBAL_PLACE_HOLDER */
    </style>

    <style type="text/css">
    /* STYLE_OUTLINE_PLACE_HOLDER */
    /* STYLE_PLACE_HOLDER */
    </style>

    <!-- EXTRA_PLACE_HOLDER -->

<!-- HEAD_PLACE_HOLDER -->
</head>
<body>
<div class="container-fluid">
<div class="row flex-xl-nowrap">
    <div id="outline-panel" style="display:none;" class="d-none d-md-block d-xl-block col-md-3 col-xl-2 bd-toc">
        <div id="outline-content" class="section-nav"></div>
    </div>
    <div id="post-content" class="col-12 col-md-9 col-xl-10 py-md-3 pl-md-5 bd-content">
    <h1 id="toc_0">概念<a class="vnote-anchor" href="#toc_0" data-anchor-icon="#"></a></h1>
<p>策略模式一般情况下应用于当一个对象有某个行为，但是在不同的场景有不同的实现方式，例如，旅游的出行方式，我们可以选择骑自行车、也可以选择坐汽车、飞机、轮船等等，每一种旅行方式都是一个策略</p>
<blockquote>
<p>如果一个系统的策略多于四个，就需要考虑使用混合模式，解决策略类膨胀的问题。</p>
</blockquote>
<h1 id="toc_1">优点<a class="vnote-anchor" href="#toc_1" data-anchor-icon="#"></a></h1>
<ul>
<li>
<p>算法可以自由切换。</p>
</li>
<li>
<p>避免使用多重条件判断。</p>
</li>
<li>
<p>扩展性良好。</p>
</li>
</ul>
<h1 id="toc_2">缺点<a class="vnote-anchor" href="#toc_2" data-anchor-icon="#"></a></h1>
<ul>
<li>
<p>策略类会增多。</p>
</li>
<li>
<p>所有策略类都需要对外暴露。</p>
</li>
</ul>
<h1 id="toc_3">代码实现<a class="vnote-anchor" href="#toc_3" data-anchor-icon="#"></a></h1>
<p>本文中的代码在Delphi10.4中测试通过，有的朋友版本可能略低，只需要把变量的声明方式改变一下即可</p>
<p><strong>uStrategy：策略模式的核心代码</strong></p>
<pre><code class="lang-pascal hljs"><span class="hljs-keyword">unit</span> uStrategy;
​
<span class="hljs-keyword">interface</span>
​
<span class="hljs-keyword">type</span>
    <span class="hljs-comment">{策略接口}</span>
    IStrategy = <span class="hljs-keyword">interface</span>(IUnKnown)
        [<span class="hljs-string">'{E919FE8C-EEF8-4B86-846B-B48D65797DDF}'</span>]
        <span class="hljs-comment">//制定策略</span>
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">doOperation</span><span class="hljs-params">(num1, num2: Integer)</span>:</span> Integer;
    <span class="hljs-keyword">end</span>;
​
    <span class="hljs-comment">//策略的具体实现方式一</span>
    <span class="hljs-title">TOperationAdd</span> = <span class="hljs-keyword">class</span>(TInterfacedObject, IStrategy)
    <span class="hljs-keyword">public</span>
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">doOperation</span><span class="hljs-params">(num1, num2: Integer)</span>:</span> Integer;
    <span class="hljs-keyword">end</span>;
​
    <span class="hljs-comment">//策略的具体实现方式二</span>
    <span class="hljs-title">TOperationSubtract</span> = <span class="hljs-keyword">class</span>(TInterfacedObject, IStrategy)
    <span class="hljs-keyword">public</span>
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">doOperation</span><span class="hljs-params">(num1, num2: Integer)</span>:</span> Integer;
    <span class="hljs-keyword">end</span>;
    <span class="hljs-comment">//真正使用策略的类</span>
    <span class="hljs-title">TOperation</span> = <span class="hljs-keyword">class</span>(TObject)
    <span class="hljs-keyword">public</span>
        <span class="hljs-comment">//Strategy:策略的类型需要使用接口类型，这样传任意的策略接口实现类即可</span>
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ExecuteStrategy</span><span class="hljs-params">(num1, num2: Integer; Strategy: IStrategy)</span>:</span> Integer;
    <span class="hljs-keyword">end</span>;
​
<span class="hljs-keyword">implementation</span>
<span class="hljs-comment">{ TOperationAdd }</span>
​
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">TOperationAdd</span>.<span class="hljs-title">doOperation</span><span class="hljs-params">(num1, num2: Integer)</span>:</span> Integer;
<span class="hljs-keyword">begin</span>
​
    Result := num1 + num2;
<span class="hljs-keyword">end</span>;
<span class="hljs-comment">{ TOperationSubtract }</span>
​
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">TOperationSubtract</span>.<span class="hljs-title">doOperation</span><span class="hljs-params">(num1, num2: Integer)</span>:</span> Integer;
<span class="hljs-keyword">begin</span>
    Result := num1 - num2;
<span class="hljs-keyword">end</span>;
<span class="hljs-comment">{ TOperation }</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">TOperation</span>.<span class="hljs-title">ExecuteStrategy</span><span class="hljs-params">(num1, num2: Integer; Strategy: IStrategy)</span>:</span> Integer;
<span class="hljs-keyword">begin</span>
    Result := Strategy.doOperation(num1, num2);
​
<span class="hljs-keyword">end</span>;
​
<span class="hljs-keyword">end</span>.
</code></pre>
<p><strong>测试代码单元</strong></p>
<pre><code class="hljs">program ProjecttTategy;
​
{$APPTYPE CONSOLE}
​
{$R *.res}
​
uses
    System.SysUtils,
    uStrategy in 'uStrategy.pas',
    UnitBack in 'UnitBack.pas';
​
begin
    var Operation := TOperation.Create();
    //我们只需要更换不同的策略实现对象，即可完成不同的运算，而TOperation类中的代码不需要做任何更改
    var res := Operation.ExecuteStrategy(1, 2, TOperationAdd.Create());
​
    writeln(res.ToString);
    readln;
end.
</code></pre>
<blockquote>
<p>这个例子我以加法和减法运算作为不同的实现的方式，目的是降低设计模式的学习难度，本来写了个结合泛型来实现数组排序的，但是会让策略模式变的难以理解，所以被我废弃了，后面有机会再和大家分享</p>
</blockquote>
<h1 id="toc_4">开放封闭原则<a class="vnote-anchor" href="#toc_4" data-anchor-icon="#"></a></h1>
<p>我们在编写代码的时候应该尽量遵循面向对象程序设计的五大原则，而开放封闭就是其中之一。软件设计本身所追求的目标就是封装变化、降低耦合，而开放封闭原则正是对这一目标的最直接体现</p>
<p>开放封闭原则指的是一个模块在扩展性方面应该是开放的而在更改性方面应该是封闭的，就我们上面的案例即接口和实现类为扩展性的代码，TOperation类为非扩展的，所以我们一般情况下应该保证在不修改TOperation它代码的前提下实现功能的扩展</p>

    </div>
</div>
</div>

<div id="container-floating" style="display:none;" class="d-none d-md-block d-xl-block">
    <div id="floating-button" onclick="toggleMore()">
        <p id="floating-more" class="more">&gt;</p>
    </div>
</div>

<!--
<div class="footer" id="vnote-footer">
    <p>Generated by <em><a href="https://tamlok.github.io/vnote/">VNote</a></em>.</p>
</div>
-->
</body>
</html>
